<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bottle Swap Game</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 1em;
    }

    .bottle-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }

    .bottle {
      width: 60px;
      height: 150px;
      cursor: pointer;
      border: 3px solid transparent;
      transition: transform 0.2s, border-color 0.2s;
    }

    .selected {
      border-color: black;
    }

    #feedback {
      font-size: 1.2em;
      margin-top: 15px;
    }

    #tries {
      font-weight: bold;
    }

    .end-message {
      font-size: 1.5em;
      color: red;
      margin-top: 20px;
    }

    #retryButton {
      display: none;
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 1em;
      background-color: #444;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    #retryButton:hover {
      background-color: #222;
    }

    select {
      padding: 5px;
      font-size: 1em;
      margin-top: 10px;
    }

    @media (max-width: 500px) {
      .bottle {
        width: 50px;
        height: 120px;
      }
    }
  </style>
</head>
<body>

<h2>üîÑ Bottle Guessing Game</h2>
<p>Tap two bottles to swap. You have 8 tries to guess the order.</p>

<label for="difficulty">Difficulty:</label>
<select id="difficulty">
  <option value="3">3 Bottles</option>
  <option value="4">4 Bottles</option>
  <option value="5" selected>5 Bottles</option>
</select>

<div class="bottle-container" id="bottles"></div>
<p id="feedback"></p>
<p id="tries">Tries: 0 / 8</p>
<p class="end-message" id="endMessage"></p>
<button id="retryButton" onclick="startGame()">üîÅ Retry Game</button>

<script>
  const allBottleImages = [
    "bottle_1.png",
    "bottle_2.png",
    "bottle_3.png",
    "bottle_4.png",
    "bottle_5.png"
  ];

  let numBottles = 5;
  let bottleImages = [];
  let groundTruth = [];
  let currentOrder = [];
  let selected = [];
  let tries = 0;
  let gameOver = false;

  const bottlesDiv = document.getElementById("bottles");
  const feedback = document.getElementById("feedback");
  const triesText = document.getElementById("tries");
  const endMessage = document.getElementById("endMessage");
  const difficultySelect = document.getElementById("difficulty");
  const retryButton = document.getElementById("retryButton");

  difficultySelect.addEventListener("change", () => {
    numBottles = parseInt(difficultySelect.value);
    startGame();
  });

  function startGame() {
    bottleImages = allBottleImages.slice(0, numBottles);
    groundTruth = [...bottleImages].sort(() => Math.random() - 0.5);
    currentOrder = [...bottleImages].sort(() => Math.random() - 0.5);
    selected = [];
    tries = 0;
    gameOver = false;

    feedback.textContent = "";
    endMessage.textContent = "";
    triesText.textContent = `Tries: 0 / 8`;
    retryButton.style.display = "none";

    renderBottles();
  }

  function renderBottles() {
    bottlesDiv.innerHTML = "";
    currentOrder.forEach((imgSrc, index) => {
      const img = document.createElement("img");
      img.src = imgSrc;
      img.className = "bottle";
      img.dataset.index = index;
      if (selected.includes(index)) img.classList.add("selected");
      img.onclick = () => handleClick(index);
      bottlesDiv.appendChild(img);
    });
  }

  function handleClick(index) {
    if (gameOver) return;

    if (selected.includes(index)) {
      selected = selected.filter(i => i !== index);
    } else {
      selected.push(index);
      if (selected.length === 2) {
        swapBottles(selected[0], selected[1]);
        selected = [];
        tries++;
        checkCorrect();
      }
    }
    renderBottles();
  }

  function swapBottles(i, j) {
    [currentOrder[i], currentOrder[j]] = [currentOrder[j], currentOrder[i]];
  }

  function checkCorrect() {
    let correct = 0;
    for (let i = 0; i < currentOrder.length; i++) {
      if (currentOrder[i] === groundTruth[i]) correct++;
    }

    feedback.textContent = `${correct} bottle(s) in the correct position`;
    triesText.textContent = `Tries: ${tries} / 8`;

    if (correct === currentOrder.length) {
      endMessage.textContent = "üéâ You win!";
      gameOver = true;
    } else if (tries >= 8) {
      endMessage.textContent = "‚ùå You lose!";
      gameOver = true;
    }

    if (gameOver) {
      retryButton.style.display = "inline-block";
    }
  }

  startGame();
</script>

</body>
</html>
